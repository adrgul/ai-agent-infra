<mxfile host="app.diagrams.net" modified="2025-12-02T00:00:00.000Z" agent="Draw.io" version="24.0.0">
  <diagram name="Component UML - Prompt-Tool-Observation-Memory" id="component">
    <mxGraphModel dx="1434" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="AI Weather Agent - Component Architecture: Prompt → Tool → Observation → Memory" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="200" y="20" width="900" height="30" as="geometry" />
        </mxCell>

        <!-- Presentation Layer -->
        <mxCell id="presentation-layer" value="PRESENTATION LAYER (Prompt Input)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;startSize=40;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="1320" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="frontend-comp" value="&lt;b&gt;&amp;lt;&amp;lt;component&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;React Frontend&lt;br&gt;&lt;br&gt;- BriefingForm&lt;br&gt;- City/Date/Language Inputs&lt;br&gt;- Profile Button" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;" vertex="1" parent="presentation-layer">
          <mxGeometry x="20" y="50" width="200" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="api-client" value="&lt;b&gt;&amp;lt;&amp;lt;component&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;API Client&lt;br&gt;&lt;br&gt;+ getBriefing()&lt;br&gt;+ getProfile()&lt;br&gt;+ updateProfile()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;" vertex="1" parent="presentation-layer">
          <mxGeometry x="260" y="50" width="200" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="prompt-note" value="PROMPT:&lt;br&gt;User enters:&lt;br&gt;• City name&lt;br&gt;• Target date&lt;br&gt;• Language preference" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;align=left;size=10;fontStyle=1" vertex="1" parent="presentation-layer">
          <mxGeometry x="500" y="50" width="180" height="90" as="geometry" />
        </mxCell>

        <!-- Application Layer -->
        <mxCell id="app-layer" value="APPLICATION LAYER (Use Cases &amp; Orchestration)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;startSize=40;" vertex="1" parent="1">
          <mxGeometry x="40" y="250" width="1320" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="fastapi" value="&lt;b&gt;&amp;lt;&amp;lt;component&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;FastAPI Router&lt;br&gt;&lt;br&gt;+ get_briefing()&lt;br&gt;+ get_profile()&lt;br&gt;+ update_profile()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;verticalAlign=top;" vertex="1" parent="app-layer">
          <mxGeometry x="20" y="50" width="180" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="usecase-comp" value="&lt;b&gt;&amp;lt;&amp;lt;component&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;BriefingUseCaseLangGraph&lt;br&gt;&lt;br&gt;+ execute(city, date, language)&lt;br&gt;- Loads user profile (MEMORY)&lt;br&gt;- Delegates to LangGraph agent" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" vertex="1" parent="app-layer">
          <mxGeometry x="240" y="50" width="240" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="container" value="&lt;b&gt;&amp;lt;&amp;lt;component&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;DI Container&lt;br&gt;&lt;br&gt;Wires:&lt;br&gt;- Services&lt;br&gt;- Repositories&lt;br&gt;- Use Cases" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="app-layer">
          <mxGeometry x="520" y="50" width="160" height="110" as="geometry" />
        </mxCell>

        <!-- LangGraph Agent Layer (Core Memory & Tool Orchestration) -->
        <mxCell id="agent-layer" value="LANGGRAPH AGENT (Memory State Machine + Tool Orchestration)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;startSize=40;" vertex="1" parent="1">
          <mxGeometry x="40" y="460" width="1320" height="280" as="geometry" />
        </mxCell>
        
        <mxCell id="agent-comp" value="&lt;b&gt;&amp;lt;&amp;lt;component&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;LangGraphWeatherAgent&lt;br&gt;&lt;br&gt;+ run(city, date, profile, lang)&lt;br&gt;+ build_graph()&lt;br&gt;- _geocode_node()&lt;br&gt;- _fetch_weather_node()&lt;br&gt;- _generate_briefing_node()&lt;br&gt;- _finalize_node()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;" vertex="1" parent="agent-layer">
          <mxGeometry x="20" y="50" width="220" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="state-memory" value="&lt;b&gt;MEMORY (AgentState)&lt;/b&gt;&lt;br&gt;&lt;br&gt;TypedDict:&lt;br&gt;- messages: list[BaseMessage]&lt;br&gt;- city: str&lt;br&gt;- target_date: date&lt;br&gt;- user_profile: UserProfile | None&lt;br&gt;- language: str | None&lt;br&gt;- location: Location | None&lt;br&gt;- weather: WeatherData | None&lt;br&gt;- briefing: Briefing | None&lt;br&gt;- final_response: BriefingResponse | None&lt;br&gt;&lt;br&gt;✓ Persists across nodes&lt;br&gt;✓ Updated by observations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontStyle=1" vertex="1" parent="agent-layer">
          <mxGeometry x="280" y="50" width="280" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="state-graph" value="&lt;b&gt;StateGraph&lt;/b&gt;&lt;br&gt;&lt;br&gt;Node Flow:&lt;br&gt;START&lt;br&gt;↓&lt;br&gt;geocode_node&lt;br&gt;↓&lt;br&gt;weather_node&lt;br&gt;↓&lt;br&gt;briefing_node&lt;br&gt;↓&lt;br&gt;finalize_node&lt;br&gt;↓&lt;br&gt;END" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;fontStyle=1" vertex="1" parent="agent-layer">
          <mxGeometry x="600" y="50" width="160" height="220" as="geometry" />
        </mxCell>

        <!-- Domain/Infrastructure Layer (Tools) -->
        <mxCell id="domain-layer" value="DOMAIN &amp; INFRASTRUCTURE LAYER (Tools - External API Calls)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;startSize=40;" vertex="1" parent="1">
          <mxGeometry x="40" y="770" width="1320" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="geocoding-tool" value="&lt;b&gt;&amp;lt;&amp;lt;tool&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;GeocodingService&lt;br&gt;&lt;br&gt;+ geocode(city)&lt;br&gt;&lt;br&gt;→ Nominatim API&lt;br&gt;&lt;br&gt;OBSERVATION:&lt;br&gt;Location(lat, lon, city, country)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="domain-layer">
          <mxGeometry x="20" y="50" width="220" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="weather-tool" value="&lt;b&gt;&amp;lt;&amp;lt;tool&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;WeatherService&lt;br&gt;&lt;br&gt;+ get_weather(lat, lon, date)&lt;br&gt;&lt;br&gt;→ Open-Meteo API&lt;br&gt;&lt;br&gt;OBSERVATION:&lt;br&gt;WeatherData(temp, wind, precip)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="domain-layer">
          <mxGeometry x="280" y="50" width="240" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="llm-tool" value="&lt;b&gt;&amp;lt;&amp;lt;tool&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;ChatOpenAI (LangChain)&lt;br&gt;&lt;br&gt;+ ainvoke(messages, response_format)&lt;br&gt;&lt;br&gt;→ OpenAI API (GPT-4o-mini)&lt;br&gt;&lt;br&gt;OBSERVATION:&lt;br&gt;Briefing(summary, outfit, activities, note)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="domain-layer">
          <mxGeometry x="560" y="50" width="280" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="profile-repo" value="&lt;b&gt;&amp;lt;&amp;lt;repository&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;UserProfileRepository&lt;br&gt;&lt;br&gt;+ get_profile()&lt;br&gt;+ save_profile()&lt;br&gt;&lt;br&gt;MEMORY PERSISTENCE:&lt;br&gt;JSON file storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;" vertex="1" parent="domain-layer">
          <mxGeometry x="880" y="50" width="200" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="history-repo" value="&lt;b&gt;&amp;lt;&amp;lt;repository&amp;gt;&amp;gt;&lt;/b&gt;&lt;br&gt;HistoryRepository&lt;br&gt;&lt;br&gt;+ add_entry()&lt;br&gt;+ get_recent()&lt;br&gt;&lt;br&gt;MEMORY PERSISTENCE:&lt;br&gt;JSON file storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;" vertex="1" parent="domain-layer">
          <mxGeometry x="1120" y="50" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- Relationships -->
        <mxCell id="rel1" value="HTTP Request" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="api-client" target="fastapi">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="560" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel2" value="execute()" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="fastapi" target="usecase-comp">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="560" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel3" value="run()" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="usecase-comp" target="agent-comp">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="400" y="500" as="sourcePoint" />
            <mxPoint x="560" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel4" value="&amp;lt;&amp;lt;uses&amp;gt;&amp;gt;" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="agent-comp" target="state-memory">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="400" y="600" as="sourcePoint" />
            <mxPoint x="560" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel5" value="TOOL CALL" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="agent-comp" target="geocoding-tool">
          <mxGeometry x="0.2" width="160" relative="1" as="geometry">
            <mxPoint x="300" y="750" as="sourcePoint" />
            <mxPoint x="460" y="750" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel6" value="TOOL CALL" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="agent-comp" target="weather-tool">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="300" y="750" as="sourcePoint" />
            <mxPoint x="460" y="750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel7" value="TOOL CALL" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="agent-comp" target="llm-tool">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="300" y="750" as="sourcePoint" />
            <mxPoint x="460" y="750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel8" value="OBSERVATION (returns to state)" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="geocoding-tool" target="state-memory">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="300" y="700" as="sourcePoint" />
            <mxPoint x="460" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel9" value="OBSERVATION" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="weather-tool" target="state-memory">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="300" y="700" as="sourcePoint" />
            <mxPoint x="460" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel10" value="OBSERVATION" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-tool" target="state-memory">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="300" y="700" as="sourcePoint" />
            <mxPoint x="460" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel11" value="get_profile() - MEMORY READ" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="usecase-comp" target="profile-repo">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="700" y="600" as="sourcePoint" />
            <mxPoint x="860" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="rel12" value="add_entry() - MEMORY WRITE" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="usecase-comp" target="history-repo">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="700" y="600" as="sourcePoint" />
            <mxPoint x="860" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- External APIs Box -->
        <mxCell id="external-box" value="EXTERNAL APIs" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;dashed=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="980" width="1320" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="ext1" value="Nominatim OSM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="external-box">
          <mxGeometry x="80" y="40" width="140" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ext2" value="Open-Meteo Weather" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="external-box">
          <mxGeometry x="360" y="40" width="140" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ext3" value="OpenAI GPT-4o-mini" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="external-box">
          <mxGeometry x="660" y="40" width="140" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ext4" value="File System (data/)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="external-box">
          <mxGeometry x="1040" y="40" width="140" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="ext-rel1" value="" style="endArrow=block;dashed=1;html=1;rounded=0;strokeWidth=1;" edge="1" parent="1" source="geocoding-tool" target="ext1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="1100" as="sourcePoint" />
            <mxPoint x="750" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ext-rel2" value="" style="endArrow=block;dashed=1;html=1;rounded=0;strokeWidth=1;" edge="1" parent="1" source="weather-tool" target="ext2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="1100" as="sourcePoint" />
            <mxPoint x="750" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ext-rel3" value="" style="endArrow=block;dashed=1;html=1;rounded=0;strokeWidth=1;" edge="1" parent="1" source="llm-tool" target="ext3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="1100" as="sourcePoint" />
            <mxPoint x="750" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ext-rel4" value="" style="endArrow=block;dashed=1;html=1;rounded=0;strokeWidth=1;" edge="1" parent="1" source="profile-repo" target="ext4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="1100" as="sourcePoint" />
            <mxPoint x="750" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ext-rel5" value="" style="endArrow=block;dashed=1;html=1;rounded=0;strokeWidth=1;" edge="1" parent="1" source="history-repo" target="ext4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="1100" as="sourcePoint" />
            <mxPoint x="750" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
